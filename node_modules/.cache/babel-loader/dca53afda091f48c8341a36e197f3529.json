{"ast":null,"code":"\"use strict\";\n\nvar __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.checkMain = exports.startMain = exports.runMain = void 0;\n\nconst axios_1 = __importDefault(require(\"axios\"));\n\nconst {\n  v4: uuidv4\n} = require('uuid');\n\nlet endpoint = 'https://api.banana.dev/';\n\nif (\"BANANA_URL\" in process.env) {\n  endpoint = process.env.BANANA_URL;\n  console.log(\"Running from\", endpoint);\n\n  if (process.env.BANANA_URL === \"local\") {\n    // console.log(\"Running from local\")\n    endpoint = \"http://localhost/\";\n  }\n}\n\nfunction runMain(apiKey, modelKey) {\n  let modelInputs = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n  return __awaiter(this, void 0, void 0, function* () {\n    const startOut = yield startAPI(apiKey, modelKey, modelInputs);\n\n    if (startOut[\"finished\"] == true) {\n      const res = {\n        \"id\": startOut[\"id\"],\n        \"message\": startOut[\"message\"],\n        \"created\": startOut[\"created\"],\n        \"apiVersion\": startOut[\"apiVersion\"],\n        \"modelOutputs\": startOut[\"modelOutputs\"]\n      };\n      return res;\n    } // else it's long running, so poll for result\n\n\n    while (true) {\n      const jsonOut = yield checkAPI(apiKey, startOut[\"callID\"]);\n\n      if (jsonOut !== undefined) {\n        if (jsonOut.message.toLowerCase() === \"success\") {\n          return jsonOut;\n        }\n      }\n    }\n  });\n}\n\nexports.runMain = runMain;\n\nfunction startMain(apiKey, modelKey) {\n  let modelInputs = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n  return __awaiter(this, void 0, void 0, function* () {\n    const jsonOut = yield startAPI(apiKey, modelKey, modelInputs, true);\n    return jsonOut[\"callID\"];\n  });\n}\n\nexports.startMain = startMain;\n\nfunction checkMain(apiKey, callID) {\n  return __awaiter(this, void 0, void 0, function* () {\n    const jsonOut = yield checkAPI(apiKey, callID);\n    return jsonOut;\n  });\n}\n\nexports.checkMain = checkMain;\n\nconst startAPI = function (apiKey, modelKey, modelInputs) {\n  let startOnly = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : false;\n  return __awaiter(void 0, void 0, void 0, function* () {\n    const urlStart = endpoint.concat(\"start/v4/\");\n    const payload = {\n      \"id\": uuidv4(),\n      \"created\": Math.floor(new Date().getTime() / 1000),\n      \"apiKey\": apiKey,\n      \"modelKey\": modelKey,\n      \"modelInputs\": modelInputs,\n      \"startOnly\": startOnly\n    };\n    const response = yield axios_1.default.post(urlStart, payload).catch(err => {\n      if (err.response) {\n        throw `server error: status code ${err.response.status}`;\n      } else if (err.request) {\n        throw 'server error: endpoint busy or not available.';\n      } else {\n        console.log(err);\n        throw \"Misc axios error. Please email erik@banana.dev with above error\";\n      }\n    });\n    const jsonOut = response.data;\n\n    if (jsonOut.message.toLowerCase().includes(\"error\")) {\n      throw jsonOut.message;\n    }\n\n    return jsonOut;\n  });\n};\n\nconst checkAPI = (apiKey, callID) => __awaiter(void 0, void 0, void 0, function* () {\n  const urlCheck = endpoint.concat(\"check/v4/\");\n  const payload = {\n    \"id\": uuidv4(),\n    \"created\": Math.floor(new Date().getTime() / 1000),\n    \"longPoll\": true,\n    \"apiKey\": apiKey,\n    \"callID\": callID\n  };\n  const response = yield axios_1.default.post(urlCheck, payload).catch(err => {\n    if (err.response) {\n      throw `server error: status code ${err.response.status}`;\n    } else if (err.request) {\n      throw 'server error: endpoint busy or not available.';\n    } else {\n      console.log(err);\n      throw \"Misc axios error. Please email erik@banana.dev with above error\";\n    }\n  });\n  const jsonOut = response.data;\n\n  if (jsonOut.message.toLowerCase().includes(\"error\")) {\n    throw jsonOut.message;\n  }\n\n  return jsonOut;\n});","map":{"version":3,"names":["__awaiter","thisArg","_arguments","P","generator","adopt","value","resolve","Promise","reject","fulfilled","step","next","e","rejected","result","done","then","apply","__importDefault","mod","__esModule","Object","defineProperty","exports","checkMain","startMain","runMain","axios_1","require","v4","uuidv4","endpoint","process","env","BANANA_URL","console","log","apiKey","modelKey","modelInputs","startOut","startAPI","res","jsonOut","checkAPI","undefined","message","toLowerCase","callID","startOnly","urlStart","concat","payload","Math","floor","Date","getTime","response","default","post","catch","err","status","request","data","includes","urlCheck"],"sources":["/Users/kylemorris/workspace/workshop_demo_storygen/my-app/node_modules/@banana-dev/banana-dev/dist/genericsUtils.js"],"sourcesContent":["\"use strict\";\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.checkMain = exports.startMain = exports.runMain = void 0;\nconst axios_1 = __importDefault(require(\"axios\"));\nconst { v4: uuidv4 } = require('uuid');\nlet endpoint = 'https://api.banana.dev/';\nif (\"BANANA_URL\" in process.env) {\n    endpoint = process.env.BANANA_URL;\n    console.log(\"Running from\", endpoint);\n    if (process.env.BANANA_URL === \"local\") {\n        // console.log(\"Running from local\")\n        endpoint = \"http://localhost/\";\n    }\n}\nfunction runMain(apiKey, modelKey, modelInputs = {}) {\n    return __awaiter(this, void 0, void 0, function* () {\n        const startOut = yield startAPI(apiKey, modelKey, modelInputs);\n        if (startOut[\"finished\"] == true) {\n            const res = {\n                \"id\": startOut[\"id\"],\n                \"message\": startOut[\"message\"],\n                \"created\": startOut[\"created\"],\n                \"apiVersion\": startOut[\"apiVersion\"],\n                \"modelOutputs\": startOut[\"modelOutputs\"]\n            };\n            return res;\n        }\n        // else it's long running, so poll for result\n        while (true) {\n            const jsonOut = yield checkAPI(apiKey, startOut[\"callID\"]);\n            if (jsonOut !== undefined) {\n                if (jsonOut.message.toLowerCase() === \"success\") {\n                    return jsonOut;\n                }\n            }\n        }\n    });\n}\nexports.runMain = runMain;\nfunction startMain(apiKey, modelKey, modelInputs = {}) {\n    return __awaiter(this, void 0, void 0, function* () {\n        const jsonOut = yield startAPI(apiKey, modelKey, modelInputs, true);\n        return jsonOut[\"callID\"];\n    });\n}\nexports.startMain = startMain;\nfunction checkMain(apiKey, callID) {\n    return __awaiter(this, void 0, void 0, function* () {\n        const jsonOut = yield checkAPI(apiKey, callID);\n        return jsonOut;\n    });\n}\nexports.checkMain = checkMain;\nconst startAPI = (apiKey, modelKey, modelInputs, startOnly = false) => __awaiter(void 0, void 0, void 0, function* () {\n    const urlStart = endpoint.concat(\"start/v4/\");\n    const payload = {\n        \"id\": uuidv4(),\n        \"created\": Math.floor(new Date().getTime() / 1000),\n        \"apiKey\": apiKey,\n        \"modelKey\": modelKey,\n        \"modelInputs\": modelInputs,\n        \"startOnly\": startOnly,\n    };\n    const response = yield axios_1.default.post(urlStart, payload).catch(err => {\n        if (err.response) {\n            throw `server error: status code ${err.response.status}`;\n        }\n        else if (err.request) {\n            throw 'server error: endpoint busy or not available.';\n        }\n        else {\n            console.log(err);\n            throw \"Misc axios error. Please email erik@banana.dev with above error\";\n        }\n    });\n    const jsonOut = response.data;\n    if (jsonOut.message.toLowerCase().includes(\"error\")) {\n        throw jsonOut.message;\n    }\n    return jsonOut;\n});\nconst checkAPI = (apiKey, callID) => __awaiter(void 0, void 0, void 0, function* () {\n    const urlCheck = endpoint.concat(\"check/v4/\");\n    const payload = {\n        \"id\": uuidv4(),\n        \"created\": Math.floor(new Date().getTime() / 1000),\n        \"longPoll\": true,\n        \"apiKey\": apiKey,\n        \"callID\": callID\n    };\n    const response = yield axios_1.default.post(urlCheck, payload).catch(err => {\n        if (err.response) {\n            throw `server error: status code ${err.response.status}`;\n        }\n        else if (err.request) {\n            throw 'server error: endpoint busy or not available.';\n        }\n        else {\n            console.log(err);\n            throw \"Misc axios error. Please email erik@banana.dev with above error\";\n        }\n    });\n    const jsonOut = response.data;\n    if (jsonOut.message.toLowerCase().includes(\"error\")) {\n        throw jsonOut.message;\n    }\n    return jsonOut;\n});\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}